<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js coal">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Leafbuild</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        
        <link rel="stylesheet" href="css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "coal" : "coal";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('coal')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="compilatoare.html"><strong aria-hidden="true">1.</strong> Introducere în compilatoare de C/C++</a></li><li class="chapter-item expanded "><a href="build_system.html"><strong aria-hidden="true">2.</strong> Introducere în build system</a></li><li class="chapter-item expanded "><a href="meta_build_system.html"><strong aria-hidden="true">3.</strong> Meta build system</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Leafbuild</h1>

                    <div class="right-buttons">
                        
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                        

                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="recap-despre-compilatoare-de-cc"><a class="header" href="#recap-despre-compilatoare-de-cc">Recap despre compilatoare de C/C++</a></h1>
<p>Compilatoarele de C/C++ de obicei cuprind următoarele 3 mari componente.</p>
<p>Să luăm un mic proiect ca exemplu, și să urmărim ce se întâmplă cât timp trecem prin procesul de compilare:</p>
<pre><code class="language-cpp">// lib.h
int adauga_unu(int n);
</code></pre>
<pre><code class="language-cpp">// lib.cpp
#include &quot;lib.h&quot;

int adauga_unu(int n) {
    return n+1;
}
</code></pre>
<pre><code class="language-cpp">// main.cpp
#include &quot;lib.h&quot;

int main() {
    return adauga_unu(-1);
}
</code></pre>
<p><code>lib.cpp</code> îl vom compila într-o librărie dinamică,
cu declarații în <code>lib.h</code> și cu <code>main.cpp</code> și librăria
dinamică rezultată vom construi o executabilă pe care o vom putea rula.</p>
<h2 id="preprocesor"><a class="header" href="#preprocesor">Preprocesor</a></h2>
<blockquote>
<p>Input: fișierele sursă (<code>.c</code>/<code>.cpp</code>/<code>.cxx</code>/<code>.cc</code>/... + headere)</p>
<p>Output: translation unit(<code>.tu</code>)</p>
</blockquote>
<p>Procesează sursele, executând directive pentru preprocesor
(<code>#include</code>, <code>#define</code>, <code>#if</code>, <code>#ifdef</code>, <code>#ifndef</code>, <code>#error</code>, <code>#undef</code>, ...).</p>
<p>La final, emite un fișier cu codul sursă întreg pentru acest fișier, folosit mai departe.</p>
<p><code>clang -E lib.cpp -o lib.tu</code></p>
<pre><code class="language-cpp">// lib.tu
# 1 &quot;lib.cpp&quot;
# 1 &quot;&lt;built-in&gt;&quot; 1
# 1 &quot;&lt;built-in&gt;&quot; 3
# 388 &quot;&lt;built-in&gt;&quot; 3
# 1 &quot;&lt;command line&gt;&quot; 1
# 1 &quot;&lt;built-in&gt;&quot; 2
# 1 &quot;lib.cpp&quot; 2
# 1 &quot;./lib.h&quot; 1
int adauga_unu(int n);
# 2 &quot;lib.cpp&quot; 2

int adauga_unu(int n) {
    return n+1;
}
</code></pre>
<p><code>clang -E main.cpp -o main.tu</code></p>
<pre><code class="language-cpp">// main.tu
# 1 &quot;main.cpp&quot;
# 1 &quot;&lt;built-in&gt;&quot; 1
# 1 &quot;&lt;built-in&gt;&quot; 3
# 388 &quot;&lt;built-in&gt;&quot; 3
# 1 &quot;&lt;command line&gt;&quot; 1
# 1 &quot;&lt;built-in&gt;&quot; 2
# 1 &quot;main.cpp&quot; 2
# 1 &quot;./lib.h&quot; 1
int adauga_unu(int n);
# 2 &quot;main.cpp&quot; 2

int main() {
  return adauga_unu(-1);
}
</code></pre>
<h2 id="compilator"><a class="header" href="#compilator">Compilator</a></h2>
<blockquote>
<p>Input: translation unit(.tu)</p>
<p>Output: fișier obiect(.o/.obj)</p>
</blockquote>
<p>Aici are loc compilarea efectivă. Aceasta etapă transformă un fișier rezultat în urma preprocesării în cod mașină.
Toate erorile în cazul în care programul este greșit sintactic, semantic sunt semnalate, au loc majoritatea optimizărilor,
&amp; a lot more.
La final, dacă totul a mers cum trebuie, acum avem un fișier obiect.</p>
<p>Pe exemplu:</p>
<p><code>clang -c -xc++ lib.tu -o lib.o -fPIC</code></p>
<p><code>clang -c -xc++ main.tu -o main.o</code></p>
<p>Acum avem fișierele obiect <code>main.o</code> și <code>lib.o</code>.</p>
<pre><code>&gt; nm lib.o
0000000000000000 T _Z10adauga_unui

&gt; nm main.o
0000000000000000 T main
                 U _Z10adauga_unui
</code></pre>
<p>“<code>_Z10</code>“ de la început și “<code>i</code>“ de la sfârșit sunt rezultate ale unui <a href="https://en.wikipedia.org/wiki/Name_mangling">proces numit “name mangling”</a>.</p>
<p>Observăm că avem în <code>lib.o</code> un simbol definit pe nume <code>_Z10adauga_unui</code>, și în <code>main.o</code> avem un
simbol definit pe nume <code>main</code>, și un simbol nedefinit pe care l-am folosit pe nume <code>_Z10adauga_unui</code>.</p>
<h2 id="linker"><a class="header" href="#linker">Linker</a></h2>
<blockquote>
<p>Input: fișiere obiect(.o/.obj)</p>
<p>Output: executabilă/librarie dinamică(fără extensie/.exe, .so/.dll)</p>
</blockquote>
<p>Acum avem mai multe fișiere obiecte. Acum treaba linkerului este să le lege și să producă o executabilă / librărie dinamică.</p>
<p>Pe exemplu, construim mai întâi librăria:</p>
<p><code>clang lib.o -shared -o libadauga_unu.so</code></p>
<p>Iar apoi executabila, cu librăria pe care am obținut-o mai devreme:</p>
<p><code>clang -L. -ladauga_unu main.o -o main</code></p>
<p>Și am ajuns la final: avem executabila pe care o putem rula.</p>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="introducere-în-build-system"><a class="header" href="#introducere-în-build-system">Introducere în build system</a></h1>
<p>După cum am putut vedea, este destul de complicat să compilezi un proiect.
Uneori, listele de opțiuni și flaguri folosite într-un proiect sunt lungi,
și apare nevoia de a refolosi comenzile de compilare.</p>
<p>Spre exemplu, în mini-proiectul nostru de la introducerea în compilatoare,
să descriem procesul de compilare folosind rețete <code>make</code>:</p>
<pre><code class="language-make">all: main

# preprocesor
lib.tu: lib.h lib.cpp
    clang -E lib.cpp -o lib.tu

main.tu: main.cpp lib.h
    clang -E main.cpp -o main.tu

# compilator
lib.o: lib.tu
    clang -c -xc++ lib.tu -o lib.o -fPIC

main.o: main.tu
    clang -c -xc++ main.tu -o main.o

# linker
libadauga_unu.so: lib.o
    clang -shared -o libadauga_unu.so lib.o

main: main.o libadauga_unu.so
    clang -L. -ladauga_unu main.o -o main
</code></pre>
<p>De obicei, preprocesorul și compilatorul sunt invocate împreună de o dată, deci:</p>
<pre><code class="language-make"># compilator
lib.o: lib.cpp lib.h
    clang -c lib.cpp -o lib.o -fPIC

main.o: main.cpp lib.h
    clang -c main.cpp -o main.o
</code></pre>
<div id="chapter_begin" style="break-before: page; page-break-before: always;"></div><h1 id="meta-build-system"><a class="header" href="#meta-build-system">Meta build system</a></h1>
<p>Exemplul, descris in leafbuild:</p>
<pre><code class="language-leafbuild">// build.leaf
project('proiect');

let adauga_unu = library('adauga_unu', shared, 'lib.cpp', include_dirs: '.');
let exe = executable('main', 'main.cpp', dependencies: {adauga_unu});
</code></pre>
<p>.... alte exemple</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        
        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            var socket = new WebSocket("ws://localhost:3000/__livereload");
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>
        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
